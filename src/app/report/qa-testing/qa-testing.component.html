<!-- Modal -->
<div class="row mb-2">
    <div class="col-md-6">
        <a onclick="goBack()"><i class="fas fa-chevron-left"></i></a> <span class="page-heading"> QA Testing
        </span>
    </div>
    <div class="col-md-6 mob-date dashdate">
        <div ng-app ng-controller="Ctrl" style="text-align: right;">
            <b style="margin-bottom: 0px;">
                {{date | date:'dd.MM.yyyy'}}
            </b>
        </div>
        <div style="text-align: right;">
            {{date | date:'EEEE'}}
        </div>
    </div>
</div>

<div class="card">
    <div class="row card-top-padding">
        <div class="col-md-3 col-xs-10">
            <div class="input-group-icon input-group-icon-left">
                <form class="form-inline" style="margin-top: 5px;">
                    <i class="fas fa-search" aria-hidden="true"></i>
                    <input class="form-control form-control-sm ml-10 w-87" id="key-search" type="text" name="search"
                        [(ngModel)]="searchText" autocomplete="off" placeholder="Search"
                        style="background-color: #d9d9d9;">
                </form>
            </div>
        </div>
        <div class="col-md-1 col-xs-2">
            <button class="btn btn-success mr-1" title="Download Excel file" (click)="exportAsXLSX()"
                style="float: right;">
                <i class="fas fa-file-excel"></i>
            </button>
        </div>
        <div class="col-md-3 m-mt-5">
            <select class="form-control" id="select2" class="form-control" (change)="select2($event)">
                <option selected value="Mapped Devices">Mapped Devices</option>
                <option value="Unmapped Devices">Unmapped Devices</option>
            </select>
        </div>
        <div class="col-md-5 m-mt-5" *ngIf ="selected2 == 'Mapped Devices'">
            <form class="form-inline" [formGroup]="formFilter" (ngSubmit)="onSubmitFilter()" style="float:right;">
                <input type="date" [ngModel]="startDate" max="{{endDate}}" formControlName="startDate" class="form-control m-w-35" style="padding: 0px 10px; margin-right: 15px;">
                <label>To</label> &nbsp;
                <input type="date" [ngModel]="endDate | date:'yyyy-MM-dd'" max="{{endDate}}" formControlName="endDate" class="form-control m-w-35" style="padding: 0px 10px; margin-right: 10px;">
                <button class="btn btn-primary" type="button" type="submit" style="padding: 6px 7px; float: right; border: none;">GO!</button>                
            </form>
        </div>
    </div>
    <div class="tableFixHead" *ngIf="selected2 == 'Mapped Devices'">
        <table class="table table-striped table-bordered table-hover">
            <thead class="thead-dark">
                <tr class="head">
                    <th>#</th>
                    <th>Device ID</th>
                    <th>Model</th>
                    <th>Pin No</th>
                    <th>Machine Data</th>
                    <th>Batch Report</th>
                </tr>
            </thead>
            <tbody>
                <!-- <tr *ngFor="let mod of model"> -->
                <tr *ngFor="let qa of dataQADocs  | filter:searchText | paginate : {itemsPerPage : itemsPerPage, currentPage : p} let i = index"
                    (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                    <td>{{itemsPerPage*(p-1)+i+1}}</td>
                    <td> {{qa.deviceID}} </td>
                    <td> {{qa.deviceModel}} </td>
                    <td> {{qa.pinno}} </td>
                    <td style="white-space: nowrap">
                        <button type="button" id="closeModel" data-toggle="modal" data-target="#exampleModal"
                            (click)="getReportQATestForMachineData(qa.deviceID, qa.deviceModel, 'report')"
                            class="btn btn-sm btn-primary mr-1" style="padding: 1px 18px;">
                            <i class="fa fa-eye"></i>
                        </button>
                    </td>
                    <td style="white-space: nowrap">
                        <button type="button" id="closeModel" class="btn btn-sm btn-primary mr-1" data-toggle="modal"
                            data-target="#exampleModal" style="padding: 1px 18px;"
                            (click)="getReportQATestForBatchData(qa.deviceID, qa.deviceModel, 'batch')">
                            <i class="fa fa-eye"></i>
                        </button>
                    </td>
                </tr>
                <tr *ngIf="!dataQADocs">
                    <td colspan="6" class="text-center">
                        <span class="spinner-border spinner-border-lg align-center"></span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="tableFixHead" *ngIf="selected2 == 'Unmapped Devices'">
        <table class="table table-striped table-bordered table-hover">

            <thead class="thead-dark">
                <tr class="head">
                    <th>#</th>
                    <th>Device ID</th>
                    <th>Machine Data</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let qa of QAUnmappedData  | filter:searchText | paginate : {itemsPerPage : itemsPerPage, currentPage : p} let i = index"
                    (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                    <td>{{itemsPerPage*(p-1)+i+1}}</td>
                    <td> {{qa.deviceID}} </td>
                    <td style="white-space: nowrap">
                        <button type="button" id="closeModel" data-toggle="modal" data-target="#exampleModal6"
                            class="btn btn-sm btn-primary mr-1" (click)="getReportQAUnmappedRawData(qa.deviceID)"
                            style="padding: 1px 18px;">
                            <i class="fa fa-eye"></i>
                        </button>
                    </td>
                </tr>
                <tr *ngIf="!QAUnmappedData">
                    <td colspan="3" class="text-center">
                        <span class="spinner-border spinner-border-lg align-center"></span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="input-group-icon input-group-icon-left text-center mt-3">
            <pagination-controls (pageChange)="p = $event"></pagination-controls>
        </div>
    </div>
</div>

<ng-container *ngIf="!hideModal">
    <div class="modal fade" id="exampleModal" data-keyboard="false" data-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-f-13" id="exampleModalLabel">{{ msg }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="clearData()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 col-xs-12 mb-1">
                            <form class="form-inline" [formGroup]="form" (ngSubmit)="onSubmit()">
                                <input type="hidden" formControlName="type" [ngModel]="type">
                                <input type="date" class="form-control m-w-40" [ngModel]="startDate"
                                    max="{{endDate}" formControlName="startDate"
                                    style="padding: 0px 10px; margin-right: 15px;">
                                <input type="date" class="form-control m-w-40" [ngModel]="endDate"
                                max="{{endDate}" formControlName="endDate" placeholder="Tosasasasas"
                                    style="padding: 0px 10px; margin-right: 10px;">
                                <button class="btn btn-success" type="button" type="submit"
                                    style="background-color:  #3385ff; padding: 2px 5px; float: right;">GO!</button>
                            </form>
                        </div>
                        <div class="col-md-4 col-xs-9" *ngIf="!batchdata">
                            <label class="radio-inline" style="margin-right: 10%; ;">
                                <input type="radio" name="optradio" style="margin-right: 10px;" checked (click)="formatedData()">Formated Data</label>
                            <label class="radio-inline">
                                <input type="radio" name="optradio" style="margin-right: 10px;" (click)="rowData()">Raw Data</label>
                        </div>
                        <div class="col-md-2 col-xs-3" *ngIf="shoxlsxbtn">
                            <button class="btn btn-primary m-qa-btn" title="Download Excel file"
                                (click)="exportAsXLSXMachine()">xlsx</button>
                        </div>
                    </div>

                    <!-- when machine data is present and formatted data is selected -->
                    <ng-container *ngIf="!batchdata && trFormatedData">
                        <div class="tableFixHead" style="margin-top: 10px;">
                            <table class="table table-striped table-bordered table-hover">
                                <thead class="thead-dark">
                                    <tr class="head">
                                        <th>#</th>
                                        <th style="width: 15%;">Date & Time</th>
                                        <th>Latitude</th>
                                        <th>Longitude</th>
                                        <th>Power Src</th>
                                        <th>Battery Level (volts) </th>
                                        <th>Fuel level</th>
                                        <th>Coolant Temp <sup> o </sup>C</th>
                                        <th>Oil Pressure (bar)</th>
                                        <th>Ignition Status (volts) </th>
                                        <th>RPM</th>
                                        <th>Parking Switch</th>
                                        <th>Hydraulic Oil Filter</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let qadevice of dataQaTestDocs  | filter:searchText | paginate : {itemsPerPage : itemsperpage1, currentPage : device} let i = index "
                                        (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                                        <td>{{itemsperpage1 *(device-1)+i+1}}</td>
                                        <td style="width: 15%;"> {{qadevice.devicePublishTime |
                                            slice:8:10}}-{{qadevice.devicePublishTime |
                                            slice:5:7}}-{{qadevice.devicePublishTime | slice:0:4}}
                                            {{qadevice.devicePublishTime | date:'h:mm:ss a':'+0000'}} </td>
                                        <td> {{qadevice.lat}} </td>
                                        <td> {{qadevice.lng}} </td>
                                        <td> {{qadevice.extras[0].powerSource}} </td>
                                        <td> {{qadevice.extras[0].batteryLevel | number : '1.1-1'}}</td>
                                        <td>{{qadevice.extras[0].fuelLevel}}</td>
                                        <td>{{qadevice.extras[0].coolantTemp}}</td>
                                        <td>{{qadevice.extras[0].oilpressure}}</td>
                                        <td>{{qadevice.extras[0].ignitionStatus}}</td>
                                        <td>{{qadevice.extras[0].rpm}}</td>
                                        <td>{{qadevice.extras[0].parkingSwitch}}</td>
                                        <td>{{qadevice.extras[0].hydralicOilFilterChoke}}</td>
                                    </tr>
                                    <tr *ngIf="loading">
                                        <td colspan="15" class="text-center">
                                            <span class="spinner-border spinner-border-lg align-center"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="!batchdata && trRowData">
                        <div class="tableFixHead" style="margin-top: 10px;">
                            <table class="table table-striped table-bordered table-hover">
                                <thead class="thead-dark">
                                    <tr class="head">
                                        <th>#</th>
                                        <th style="width: 15%;">Date and Time <br>
                                            dd-mm-yyyy hh24:mi:ss </th>
                                        <th>Latitude</th>
                                        <th>Longitude</th>
                                        <th>Power Src</th>
                                        <th>Battery Level (volts) </th>
                                        <th>Fuel level (volts)</th>
                                        <th>Coolant Temp (volts) </th>
                                        <th>Oil Pressure (volts)</th>
                                        <th>Ignition Status (volts) </th>
                                        <th>RPM</th>
                                        <th>Parking Switch</th>
                                        <th>Hydraulic Oil Filter</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="actualRowData.length>0">
                                    <tr *ngFor="let item of actualRowData | paginate : {itemsPerPage : itemsperpage2, currentPage : device} let i = index"
                                        (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                                        <td>{{itemsperpage2 *(device-1)+i+1}}</td>
                                        <td style="width: 15%;"> {{item.rowData[9] | slice : 0 : 2}}-{{item.rowData[9]
                                            | slice : 2 : 4 }}-{{item.rowData[9] | slice : 4: 8 }}<br>
                                            {{item.rowData[10] | slice : 0 : 2 }}:{{item.rowData[10] | slice : 2 :4
                                            }}:{{item.rowData[10] | slice : 4 : 6 }}
                                        </td>
                                        <td> {{item.rowData[11]}} </td>
                                        <td> {{item.rowData[13]}}</td>
                                        <td></td>
                                        <td>{{item.rowData[24]}}</td>
                                        <td>{{item.rowData[48]}}</td>
                                        <td>{{item.rowData[49]}}</td>
                                        <td>{{item.rowData[50]}}</td>
                                        <td>{{item.rowData[22]}}</td>
                                        <td>{{item.rowData[54] | slice : 0 : 1 }}</td>
                                        <td>{{item.rowData[45] | slice : 1 : 1 }}</td>
                                        <td>{{item.rowData[45] | slice : 0 : 1}}</td>
                                    </tr>
                                    <tr *ngIf="loading">
                                        <td colspan="14" class="text-center">
                                            <span class="spinner-border spinner-border-lg align-center"></span>
                                        </td>
                                    </tr>
                                </tbody>
                                <tbody *ngIf="actualRowData1.length>0">
                                    <tr *ngFor="let item of actualRowData1 | paginate : {itemsPerPage:itemsperpage2, currentPage : device} let i = index"
                                        (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                                        <td>{{itemsperpage2 *(device-1)+i+1}}</td>
                                        <td style="width: 15%;"> {{item.rowData[4] | slice : 6 : 8}}-{{item.rowData[4]
                                            | slice : 4 : 6 }}-{{item.rowData[4] | slice : 0 : 4 }}<br>
                                            {{item.rowData[4] | slice : 8 : 10 }}:{{item.rowData[4] | slice : 10 : 12
                                            }}:{{item.rowData[4] | slice : 12 : 14 }}
                                        </td>
                                        <td>{{item.rowData[7]}}</td>
                                        <td>{{item.rowData[9]}}</td>
                                        <td>{{item.rowData[13]}}</td>
                                        <td>{{item.rowData[14]}}</td>
                                        <td>{{item.rowData[17]}}</td>
                                        <td>{{item.rowData[18]}}</td>
                                        <td>{{item.rowData[19]}}</td>
                                        <td>{{item.rowData[25]}}</td>
                                        <td>{{item.rowData[26]}}</td>
                                        <td>{{item.rowData[27]}}</td>
                                        <td>{{item.rowData[28]}}</td>
                                    </tr>
                                    <tr *ngIf="loading">
                                        <td colspan="14" class="text-center">
                                            <span class="spinner-border spinner-border-lg align-center"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="batchdata">
                        <div class="tableFixHead" style="margin-top: 10px;">
                            <table class="table table-striped table-bordered table-hover">
                                <thead class="thead-dark">
                                    <tr>
                                        <th style="vertical-align: top;">#</th>
                                        <th style="vertical-align: top;">Batch No.</th>
                                        <th style="vertical-align: top;">AGGT10mm</th>
                                        <th style="vertical-align: top;">AGGT20mm</th>
                                        <th style="vertical-align: top;">AGGT30mm</th>
                                        <th style="vertical-align: top;">CEMT01</th>
                                        <th style="vertical-align: top;">CEMT02</th>
                                        <th style="vertical-align: top;">SAND01</th>
                                        <th style="vertical-align: top;">SAND02</th>
                                        <th style="vertical-align: top;">Water</th>
                                        <th style="vertical-align: top;">Additive</th>
                                        <th style="vertical-align: top;">Total WT</th>
                                        <th style="vertical-align: top;">CuM</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of batchDatadocs | paginate : {itemsPerPage : itemsperpage3, currentPage : device} let i = index"
                                        (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                                        <td>{{itemsperpage3 *(device-1)+i+1}}</td>
                                        <td>{{item.batchNo}}</td>
                                        <td>{{item.aggt10mm}}</td>
                                        <td>{{item.aggt20mm}}</td>
                                        <td>{{item.aggt30mm}}</td>
                                        <td>{{item.cement01mm}}</td>
                                        <td>{{item.cement02mm}}</td>
                                        <td>{{item.sand01mm}}</td>
                                        <td>{{item.sand02mm}}</td>
                                        <td>{{item.water}}</td>
                                        <td>{{item.additive1}}</td>
                                        <td>{{item.totalWT}}</td>
                                        <td>{{item.cum}}</td>
                                    </tr>
                                    <tr *ngIf="loading">
                                        <td colspan="15" class="text-center">
                                            <span class="spinner-border spinner-border-lg align-center"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </ng-container>
                </div>

                <div class="modal-footer">
                    <pagination-controls (pageChange)="device = $event"></pagination-controls>
                </div>

            </div>
        </div>
    </div>
</ng-container>


<ng-container>
    <div class="modal fade" id="exampleModal6" data-keyboard="false" data-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel6" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-f-13" id="exampleModalLabel6">{{msg1}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="clearData()"><span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- when machine data is present and formatted data is selected -->
                    <div class="row">
                        <form class="form-inline ml-3" [formGroup]="formUnMap">
                            Date: <input type="date" class="form-control" [ngModel]="endDate" max="{{endDate}}" formControlName="endDate" style="padding: 0px 10px; margin-right: 15px;">
                            <button class="btn btn-success" type="button" (click)="getReportQAUnmappedRawData(unMapDeviceId)" style="background-color:  #3385ff; padding: 2px 5px; float: right;">GO!</button>
                        </form>
                    </div>
                        <div class="tableFixHead" style="margin-top: 10px;">
                            <table class="table table-striped table-bordered table-hover">
                                <thead class="thead-dark">
                                    <tr class="head">
                                        <th>#</th>
                                        <th style="width: 15%;">Date and Time</th>
                                        <th>Latitude</th>
                                        <th>Longitude</th>
                                        <th>Power Src</th>
                                        <th>Battery Level (volts) </th>
                                        <th>Fuel level (volts)</th>
                                        <th>Coolant Temp (volts) </th>
                                        <th>Oil Pressure (volts)</th>
                                        <th>Ignition Status (volts) </th>
                                        <th>RPM</th>
                                        <th>Parking Switch</th>
                                        <th>Hydraulic Oil Filter</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of dataQaTestUnmappedDocs | paginate : {itemsPerPage:itemsperpage2, currentPage : device} let i = index"
                                        (click)="setClickedRow(i)" [class.active]="i == selectedRow">
                                        <td>{{itemsperpage3 *(device-1)+i+1}}</td>
                                        <td style="width: 15%;">{{item.Rawdata[9]}} <br> {{item.Rawdata[10]}}
                                        </td>
                                        <td>{{item.Rawdata[11]}}</td>
                                        <td>{{item.Rawdata[13]}}</td>
                                        <td>{{item.Rawdata[24]}}</td>
                                        <td>{{item.Rawdata[25]}}</td>
                                        <td>{{item.Rawdata[48]}}</td>
                                        <td>{{item.Rawdata[49]}}</td>
                                        <td>{{item.Rawdata[50]}}</td>
                                        <td>{{item.Rawdata[22]}}</td>
                                        <td>{{item.Rawdata[54]}}</td>
                                        <td>{{item.Rawdata[45] | slice : 0 : 1 }}</td>
                                        <td>{{item.Rawdata[45] | slice : 1 : 2}}</td>
                                    </tr>
                                    <tr *ngIf="loading">
                                        <td colspan="14" class="text-center">
                                            <span class="spinner-border spinner-border-lg align-center"></span>
                                        </td>
                                    </tr>
                                </tbody>

                            </table>
                        </div>
                </div>

                <div class="modal-footer">
                    <pagination-controls (pageChange)="device = $event"></pagination-controls>
                </div>

            </div>
        </div>
    </div>
</ng-container>